(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{373:function(e,t){e.exports="data:image/png;base64,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"},422:function(e,t,a){"use strict";a.r(t);var s=a(14),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"ble-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ble-gateway"}},[e._v("#")]),e._v(" BLE gateway")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),t("p",[e._v("We strongly encourage the use of a white-list (see below) so as to collect data from your devices only and not from other MAC addresses.\nBy default the gateway scans the advertizing BLE devices nearby with their MAC addresses. Depending on your country, it may be illegal to monitor networks for MAC addresses, especially on networks that you do not own. Please check your country's laws (for US Section 18 U.S. Code ยง 2511) - "),t("a",{attrs:{href:"https://github.com/schollz/howmanypeoplearearound/issues/4",target:"_blank",rel:"noopener noreferrer"}},[e._v("discussion here"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("h2",{attrs:{id:"receiving-signals-from-ble-beacon-devices-for-presence-detection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receiving-signals-from-ble-beacon-devices-for-presence-detection"}},[e._v("#")]),e._v(" Receiving signals from BLE beacon devices for Presence detection")]),e._v(" "),t("p",[e._v("Subscribe to all the messages with mosquitto or open your MQTT client software:")]),e._v(" "),t("p",[t("code",[e._v("sudo mosquitto_sub -t +/# -v")])]),e._v(" "),t("p",[t("em",[e._v("NOTE: HM-10 or HM-11 module needed if you are not using ESP32; configure in "),t("code",[e._v("User_config.h")])])]),e._v(" "),t("p",[e._v("The BT gateway module for OpenMQTTGateway enables the detection of BLE beacons and their signal strength.  Generally BLE devices will not broadcast if they are paired so you may need to ensure your beacons is unpaired before it will be seen by the gateway.")]),e._v(" "),t("p",[e._v("If beacons are detected the gateway will periodically publish messages to MQTT (beacons must not be paired, see above):")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('home/OpenMQTTGateway/BTtoMQTT/45E174126E00 {"id":"45:e1:74:12:6e:00","rssi":-89,"distance":21.51847,"servicedata":"fe0000000000000000000000000000000000000000"}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('home/OpenMQTTGateway/BTtoMQTT/C7FaaD132C00 {"id":"c7:fa:ad:13:2c:00","rssi":-68,"distance":2.799256,"servicedata":"drfgdrgdsrgesrdgdrgdregesrgtrhtyhtfyhdtyhh"}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The subtopic after "),t("code",[e._v("home/BTtoMQTT/")]),e._v(" is the MAC address of the Bluetooth low energy beacon.  The rssi value is the "),t("a",{attrs:{href:"https://www.metageek.com/training/resources/understanding-rssi.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("RSSI signal level"),t("OutboundLink")],1),e._v(" from which you may deduce the relative distance to the device.\nConsider the distance as a beta feature as currently we are not retrieving the emitting power of the beacon to make it more accurate.")]),e._v(" "),t("p",[e._v("Note that you can find apps to simulate beacons and do some tests like "),t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=net.alea.beaconsimulator",target:"_blank",rel:"noopener noreferrer"}},[e._v("Beacon simulator"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("iOS version >=10 devices advertise without an extra app MAC address, nevertheless this address "),t("a",{attrs:{href:"https://github.com/1technophile/OpenMQTTGateway/issues/71",target:"_blank",rel:"noopener noreferrer"}},[e._v("changes randomly"),t("OutboundLink")],1),e._v(" and cannot be used for presence detection. You must install an app to advertise a fixed MAC address.")]),e._v(" "),t("h2",{attrs:{id:"receiving-signals-from-ble-devices-mi-flora-mi-jia-lywds02-lywsd03mmc-cleargrass-mi-scale-and-many-more"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receiving-signals-from-ble-devices-mi-flora-mi-jia-lywds02-lywsd03mmc-cleargrass-mi-scale-and-many-more"}},[e._v("#")]),e._v(" Receiving signals from BLE devices Mi Flora, Mi jia, LYWDS02, LYWSD03MMC, ClearGrass, Mi scale and "),t("a",{attrs:{href:"https://compatible.openmqttgateway.com/index.php/devices/ble-devices/",target:"_blank",rel:"noopener noreferrer"}},[e._v("many more"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("So as to receive BLE sensors data you need a simple ESP32\nThe mi flora supported firmware is >3.1.8")]),e._v(" "),t("p",[e._v("Verify that your sensor is working with the App and update it with the last software version.\nYou should see in your MQTT broker the following data:\n"),t("img",{attrs:{src:a(373),alt:""}})]),e._v(" "),t("p",[e._v("Note that the gateway return one or two measurement value each time. The different measures depending on the devices are:")]),e._v(" "),t("ul",[t("li",[e._v("Lux")]),e._v(" "),t("li",[e._v("Temperature")]),e._v(" "),t("li",[e._v("Moisture")]),e._v(" "),t("li",[e._v("Fertilization")]),e._v(" "),t("li",[e._v("Humidity")]),e._v(" "),t("li",[e._v("Pressure")]),e._v(" "),t("li",[e._v("Steps")]),e._v(" "),t("li",[e._v("Weight")]),e._v(" "),t("li",[e._v("Impedance")]),e._v(" "),t("li",[e._v("Battery")]),e._v(" "),t("li",[e._v("Voltage")]),e._v(" "),t("li",[e._v("Open")]),e._v(" "),t("li",[e._v("Presence")])]),e._v(" "),t("p",[e._v("The infos will appear like this on your MQTT broker:")]),e._v(" "),t("p",[t("code",[e._v('home/OpenMQTTGateway/BTtoMQTT/4C33A6603C79 {"hum":"52.6","tempc":"19.2","tempf":"66.56"}')])]),e._v(" "),t("p",[e._v("More info are available on "),t("a",{attrs:{href:"https://1technophile.blogspot.fr/2017/11/mi-flora-integration-to-openmqttgateway.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("my blog"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("OpenMQTTGateway publish the servicedata field of your BLE devices.")])]),e._v(" "),t("h2",{attrs:{id:"setting-a-white-or-black-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-a-white-or-black-list"}},[e._v("#")]),e._v(" Setting a white or black list")]),e._v(" "),t("p",[e._v("A black list is a list of MAC addresses that will never be published by OMG\nto set black list\n"),t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{"black-list":["01:23:14:55:16:15","4C:65:77:88:9C:79","4C:65:A6:66:3C:79"]}\'')])]),e._v(" "),t("p",[e._v("A white list is a list of MAC addresses permitted to be published by OMG\nto set white list\n"),t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{"white-list":["01:23:14:55:16:15","4C:65:77:88:9C:79","4C:65:A6:66:3C:79"]}\'')])]),e._v(" "),t("p",[e._v("Note: if you want to filter (white or black list) on BLE sensors that are auto discovered, you need to wait for the discovery before applying the white or black list, or temporarily disable it:")]),e._v(" "),t("p",[e._v("to temporarily disable white/black list\n"),t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"ignoreWBlist\":true}'")])]),e._v(" "),t("p",[e._v("to enable white/black list back\n"),t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"ignoreWBlist\":false}'")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("So as to keep your white/black list persistent you can publish it with the retain option of MQTT (-r with mosquitto_pub or retain check box of MQTT Explorer)\n"),t("code",[e._v('mosquitto_pub -r -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{"white-list":["01:23:14:55:16:15","4C:65:77:88:9C:79","4C:65:A6:66:3C:79"]}\'')])])]),e._v(" "),t("h2",{attrs:{id:"setting-the-time-between-ble-scans-and-force-a-scan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-the-time-between-ble-scans-and-force-a-scan"}},[e._v("#")]),e._v(" Setting the time between BLE scans and force a scan")]),e._v(" "),t("p",[e._v("If you want to change the time between readings you can change the interval by MQTT.\nFor example, if you want the BLE to scan every 66 seconds:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"interval\":66000}'")])]),e._v(" "),t("p",[e._v("you can also force a scan to be done by the following command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"interval\":0}'")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.")])]),e._v(" "),t("p",[e._v("Once the forced scan has completed, the previous scan interval value will be restored. Forcing a scan command trigger also a BLE connect process after the scan (see below).")]),e._v(" "),t("p",[e._v("The default value "),t("code",[e._v("TimeBtwRead")]),e._v(" is set into config_BT.h or into your .ini file for platformio users.")]),e._v(" "),t("p",[e._v("If you want to scan continuously for BLE devices, for example for beacon location you can set the interval to 1ms:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"interval\":1}'")])]),e._v(" "),t("p",[e._v("In this case you should deactivate the BLE connection mechanism to avoid concurrency between scan and connections (see chapter below, bleconnect).")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("For certain devices like LYWSD03MMC OpenMQTTGateway use a connection (due to the fact that the advertized data are encrypted), this connection mechanism is launched after every "),t("code",[e._v("TimeBtwConnect")]),e._v(" per default, you can modify it by following the procedure below.")])]),e._v(" "),t("h2",{attrs:{id:"setting-the-time-between-connection-attempts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-the-time-between-connection-attempts"}},[e._v("#")]),e._v(" Setting the time between connection attempts")]),e._v(" "),t("p",[e._v("If you want to change the time between BLE connect you can change it by MQTT, if you want the BLE connect time to be every 300s:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"intervalcnct\":300000}'")])]),e._v(" "),t("h2",{attrs:{id:"setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors-default-false"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-if-the-gateway-publishes-all-the-ble-devices-scanned-or-only-the-detected-sensors-default-false"}},[e._v("#")]),e._v(" Setting if the gateway publishes all the BLE devices scanned or only the detected sensors (default: false)")]),e._v(" "),t("p",[e._v("If you want to change this characteristic:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"onlysensors\":true}'")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.")])]),e._v(" "),t("p",[e._v("The gateway will publish only the detected sensors like Mi Flora, Mi jia, LYWSD03MMC... and not the other BLE devices. This is useful if you don't use the gateway for presence detection but only to retrieve sensors data.")]),e._v(" "),t("h2",{attrs:{id:"setting-if-the-gateway-use-active-or-passive-scanning"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-if-the-gateway-use-active-or-passive-scanning"}},[e._v("#")]),e._v(" Setting if the gateway use active or passive scanning")]),e._v(" "),t("p",[e._v("If you want to change this characteristic (default:true):")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"activescan\":false}'")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.")])]),e._v(" "),t("p",[e._v("If false, the gateway will only do a passive scanning (not request for sensor broadcasts), some sensors may not advertize their data with passive scanning.")]),e._v(" "),t("h2",{attrs:{id:"setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-if-the-gateway-connects-to-ble-devices-eligibles-on-esp32"}},[e._v("#")]),e._v(" Setting if the gateway connects to BLE devices eligibles on ESP32")]),e._v(" "),t("p",[e._v("If you want to change this characteristic:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"bleconnect\":false}'")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("With Home Assistant, this command is directly available through MQTT auto discovery as a switch into the HASS OpenMQTTGateway device entities list.")])]),e._v(" "),t("h2",{attrs:{id:"setting-if-the-gateway-publish-into-home-assistant-home-presence-topic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-if-the-gateway-publish-into-home-assistant-home-presence-topic"}},[e._v("#")]),e._v(" Setting if the gateway publish into Home Assistant Home presence topic")]),e._v(" "),t("p",[e._v("If you want to publish to Home Assistant presence topic, you can activate this function by the HASS interface (this command is auto discovered), "),t("RouterLink",{attrs:{to:"/integrate/home_assistant.html#mqtt-room-presence"}},[e._v("here is a yaml example")]),e._v(".\nOr by an MQTT command.")],1),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"hasspresence\":true}'")])]),e._v(" "),t("p",[e._v("To change presence publication topic, use this MQTT command:")]),e._v(" "),t("p",[t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{"presenceTopic":"presence/"}\'')])]),e._v(" "),t("p",[e._v("To use iBeacon UUID for presence, instead of sender (random) MAC address, use this MQTT command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"presenceUseBeaconUuid\":true}'")])]),e._v(" "),t("p",[e._v("This will change usual payload for iBeacon from:\n"),t("code",[e._v('{"id":"60:87:57:4C:9B:C2","mac_type":1,"rssi":-78,"distance":7.85288,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66}')]),e._v("\nTo:\n"),t("code",[e._v('{"id":"1de4b189115e45f6b44e509352269977","mac_type":1,"rssi":-78,"distance":7.85288,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66,"mac":"60:87:57:4C:9B:C2"}')]),e._v('\nNote: the MAC address is put in "mac" field.')]),e._v(" "),t("h2",{attrs:{id:"setting-if-the-gateway-uses-ibeacon-uuid-as-topic-instead-of-random-mac-address"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-if-the-gateway-uses-ibeacon-uuid-as-topic-instead-of-random-mac-address"}},[e._v("#")]),e._v(" Setting if the gateway uses iBeacon UUID as topic, instead of (random) MAC address")]),e._v(" "),t("p",[e._v("By default, iBeacon are published like other devices, using a topic based on the MAC address of the sender.\nBut modern phones randomize their Bluetooth MAC address making it difficult to track iBeacon.")]),e._v(" "),t("p",[e._v("For example, the 2 following messages corresponds to the same iBeacon, but with different MAC and topics:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('home/OpenMQTTGateway/BTtoMQTT/58782076BC24 {"id":"58:78:20:76:BC:24","mac_type":1,"rssi":-79,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66}\nhome/OpenMQTTGateway/BTtoMQTT/5210A84690AC {"id":"52:10:A8:46:90:AC","mac_type":1,"rssi":-77,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("To use iBeacon UUID as topic, use this MQTT command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"pubBeaconUuidForTopic\":true}'")])]),e._v(" "),t("p",[e._v("Resulting in such messages (for the same iBeacon as previously):")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('home/OpenMQTTGateway/BTtoMQTT/1de4b189115e45f6b44e509352269977 {"id":"52:10:A8:46:90:AC","mac_type":1,"rssi":-76,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66}\nhome/OpenMQTTGateway/BTtoMQTT/1de4b189115e45f6b44e509352269977 {"id":"7B:63:C6:82:DC:57","mac_type":1,"rssi":-83,"brand":"GENERIC","model":"iBeacon","model_id":"IBEACON","mfid":"4c00","uuid":"1de4b189115e45f6b44e509352269977","major":0,"minor":0,"txpower":-66}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"setting-the-minimum-rssi-accepted-to-publish-device-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-the-minimum-rssi-accepted-to-publish-device-data"}},[e._v("#")]),e._v(" Setting the minimum RSSI accepted to publish device data")]),e._v(" "),t("p",[e._v("If you want to change the minimum RSSI value accepted for a device to be published, you can change it by MQTT. For example if you want to set -80")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"minrssi\":-80}'")])]),e._v(" "),t("p",[e._v("you can also accept all the devices by the following command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"minrssi\":-200}'")])]),e._v(" "),t("p",[e._v("The default value is set into config_BT.h")]),e._v(" "),t("h2",{attrs:{id:"advanced-setting-up-an-external-decoder"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advanced-setting-up-an-external-decoder"}},[e._v("#")]),e._v(" ADVANCED: Setting up an external decoder")]),e._v(" "),t("p",[e._v("This advanced option is used to publish raw radio frames on a specific topic to be decoded by an external decoder instead of the integrated one.")]),e._v(" "),t("p",[e._v("To enable external decoder:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"extDecoderEnable\":true}'")])]),e._v(" "),t("p",[e._v('To change the default external decoder topic to "undecoded":')]),e._v(" "),t("p",[t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{"extDecoderTopic":"undecoded"}\'')])]),e._v(" "),t("h2",{attrs:{id:"advanced-filtering-out-connectable-devices"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advanced-filtering-out-connectable-devices"}},[e._v("#")]),e._v(" ADVANCED: Filtering out connectable devices")]),e._v(" "),t("p",[t("RouterLink",{attrs:{to:"/integrate/openhab2.html"}},[e._v("With OpenHAB integration")]),e._v(", this configuration is highly recommended, otherwise you may encounter incomplete data.")],1),e._v(" "),t("p",[e._v("If you want to enable this feature:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"filterConnectable\":true}'")])]),e._v(" "),t("h2",{attrs:{id:"advanced-publishing-advertisement-and-advanced-data-default-false"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advanced-publishing-advertisement-and-advanced-data-default-false"}},[e._v("#")]),e._v(" ADVANCED: Publishing advertisement and advanced data (default: false)")]),e._v(" "),t("p",[e._v("If you want to enable this feature:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"pubadvdata\":true}'")])]),e._v(" "),t("p",[e._v("This will publish extensive information about the device:")]),e._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"11:22:33:44:55:66"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"mac_type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"adv_type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Qingping Motion & Light"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"rssi"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("-93")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"servicedata"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"88121122334455660201520f0126090403000000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"servicedatauuid"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xfdcd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"brand"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Qingping"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"model"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Motion & Light"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"model_id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"CGPR1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"lux"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"batt"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("82")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"advanced-not-publishing-advertisement-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advanced-not-publishing-advertisement-data"}},[e._v("#")]),e._v(" ADVANCED: Not publishing advertisement data")]),e._v(" "),t("p",[e._v("To stop publishing advertisement data:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"pubadvdata\":false}'")])]),e._v(" "),t("h2",{attrs:{id:"store-ble-configuration-into-the-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store-ble-configuration-into-the-gateway"}},[e._v("#")]),e._v(" Store BLE configuration into the gateway")]),e._v(" "),t("p",[e._v("Open MQTT Gateway has the capability to save the current configuration and reload it at startup.")]),e._v(" "),t("p",[e._v("To store the running configuration into the gateway, use the command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"save\":true}'")])]),e._v(" "),t("p",[e._v("At any time, you can reload the stored configuration with the command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"load\":true}'")])]),e._v(" "),t("p",[e._v("If you want to erase the stored configuration, use the command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"erase\":true}'")]),e._v("\nNote that it will not change the running configuration, only ensure default configuration is used at next startup.")]),e._v(" "),t("p",[e._v("By the way, if you want to load the default built-in configuration (on any board, not only ESP32), use the command:")]),e._v(" "),t("p",[t("code",[e._v("mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m '{\"init\":true}'")]),e._v("\nNote that it will not change the stored configuration, "),t("code",[e._v("erase")]),e._v(" or "),t("code",[e._v("save")]),e._v(" is still needed to overwrite the saved configuration.")]),e._v(" "),t("h2",{attrs:{id:"read-write-ble-characteristics-over-mqtt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#read-write-ble-characteristics-over-mqtt"}},[e._v("#")]),e._v(" Read/write BLE characteristics over MQTT")]),e._v(" "),t("p",[e._v("The gateway can read and write BLE characteristics from devices and provide the results in an MQTT message.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("These actions will be taken on the next BLE connection, which occurs after scanning and after the scan count is reached, "),t("a",{attrs:{href:"#setting-the-number-of-scans-between-connection-attempts"}},[e._v("see above to set this")]),e._v(".\nThis can be overridden by providing an (optional) parameter "),t("code",[e._v('"immediate": true')]),e._v(" within the command. This will cause the BLE scan to stop if currently in progress, allowing the command to be immediately processed. All other connection commands in queue will also be processed for the same device, commands for other devices will be deferred until the next normally scheduled connection.")]),e._v(" "),t("p",[t("strong",[e._v("Note")]),e._v(' Some devices need to have the MAC address type specified. You can find this type by checking the log/MQTT data and looking for "mac_type". The mac_type of your device can be seen by setting '),t("code",[e._v("pubadvdata")]),e._v(" to "),t("code",[e._v("true")]),e._v(" with an MQTT command (see Publishing advertisement data), or with the macro "),t("code",[e._v("pubBLEAdvData true")]),e._v(". By default the type is 0 but some devices use different type values. You must specify the correct type to connect successfully."),t("br"),e._v("\nTo specify the MAC address type add the parameter "),t("code",[e._v('"mac_type"')]),e._v(" to the command. For example "),t("code",[e._v('"mac_type": 1')]),e._v(" to connect with a device with the MAC address type of 1.")])]),e._v(" "),t("h3",{attrs:{id:"example-write-command"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-write-command"}},[e._v("#")]),e._v(" Example write command")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{\n  "ble_write_address":"AA:BB:CC:DD:EE:FF",\n  "ble_write_service":"cba20d00-224d-11e6-9fb8-0002a5d5c51b",\n  "ble_write_char":"cba20002-224d-11e6-9fb8-0002a5d5c51b",\n  "ble_write_value":"TEST",\n  "value_type":"STRING",\n  "ttl":4,\n  "immediate":true }\'\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[e._v("Response:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('{\n  "id":"AA:BB:CC:DD:EE:FF",\n  "service":"cba20d00-224d-11e6-9fb8-0002a5d5c51b",\n  "characteristic":"cba20002-224d-11e6-9fb8-0002a5d5c51b",\n  "write":"TEST",\n  "success":true\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("h3",{attrs:{id:"example-read-command"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-read-command"}},[e._v("#")]),e._v(" Example read command")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{\n  "ble_read_address":"AA:BB:CC:DD:EE:FF",\n  "ble_read_service":"cba20d00-224d-11e6-9fb8-0002a5d5c51b",\n  "ble_read_char":"cba20002-224d-11e6-9fb8-0002a5d5c51b",\n  "value_type":"STRING",\n  "ttl": 2 }\'\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("Response:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('{\n  "id":"AA:BB:CC:DD:EE:FF",\n  "service":"cba20d00-224d-11e6-9fb8-0002a5d5c51b",\n  "characteristic":"cba20002-224d-11e6-9fb8-0002a5d5c51b",\n  "read":"TEST",\n  "success":true\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("ttl")]),e._v(" parameter is the number of attempts to connect (defaults to 1), which occur after the BLE scan completes."),t("br"),e._v(" "),t("code",[e._v("value_type")]),e._v(" can be one of: STRING, HEX, INT, FLOAT. Default is STRING if omitted in the message.")])]),e._v(" "),t("h2",{attrs:{id:"switchbot-bot-control"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#switchbot-bot-control"}},[e._v("#")]),e._v(" SwitchBot Bot control")]),e._v(" "),t("p",[e._v("SwitchBot Bot devices are automatically discovered and available as a device in the configuration menu of home assistant.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("If the SwitchBot mode is changed the ESP32 must be restarted. :::")]),e._v(" "),t("p",[e._v("The device can also be controlled over MQTT with a simplified BLE write command.")]),e._v(" "),t("h3",{attrs:{id:"example-command-to-set-the-switchbot-state-to-on"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-command-to-set-the-switchbot-state-to-on"}},[e._v("#")]),e._v(" Example command to set the SwitchBot state to ON:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('mosquitto_pub -t home/OpenMQTTGateway/commands/MQTTtoBT/config -m \'{\n  "SBS1":"on",\n  "mac":"AA:BB:CC:DD:EE:FF"\n}\'\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[e._v("Response (assuming success):")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('{\n  "id":"AA:BB:CC:DD:EE:FF",\n  "state":"on"\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);